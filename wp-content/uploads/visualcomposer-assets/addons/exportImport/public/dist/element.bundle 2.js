"use strict";(self.vcvWebpackJsonp4x=self.vcvWebpackJsonp4x||[]).push([["element"],{"./addon/exportImport/index.js":function(e,t,r){var s=r("./node_modules/react/index.js"),n=r("./node_modules/react-dom/index.js"),o=r("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),a=r("./node_modules/@babel/runtime/helpers/esm/createClass.js"),i=r("./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),c=r("./node_modules/@babel/runtime/helpers/esm/inherits.js"),u=r("./node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js"),l=r("./node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js"),m=r("./node_modules/@babel/runtime/helpers/esm/defineProperty.js");function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,s=(0,l.default)(e);if(t){var n=(0,l.default)(this).constructor;r=Reflect.construct(s,arguments,n)}else r=s.apply(this,arguments);return(0,u.default)(this,r)}}var d=(0,r("./node_modules/vc-cake/index.js").getService)("dataProcessor"),p=function(e){(0,c.default)(r,e);var t=v(r);function r(e){var s;return(0,o.default)(this,r),s=t.call(this,e),(0,m.default)((0,i.default)(s),"getJsonFromString",(function(e){var t=e.match(/(\{"\w+".*\})/g);return!!t&&t[0]})),s.state={importing:!1,statusMessages:[],importingDone:!1,importRequestDone:!1,errorMessage:""},s.handleImportClick=s.handleImportClick.bind((0,i.default)(s)),s}return(0,a.default)(r,[{key:"componentWillUnmount",value:function(){this.serverProgressRequest.cancelled=!0,this.serverImportRequest.cancelled=!0}},{key:"handleImportClick",value:function(e){e&&e.preventDefault();var t=document.querySelector('input[name="vcv-file-id"]'),r=t&&t.value;r&&(this.setState({importing:!0}),document.querySelector(".vcv-start-import-inner").outerHTML="",this.createServerProgressRequest(r),this.createServerImportRequest(r))}},{key:"createServerProgressRequest",value:function(e){var t=this;this.serverProgressRequest=d.appAdminServerRequest({"vcv-action":"vcv:addon:exportImport:importProgress:adminNonce","vcv-nonce":window.vcvNonce,"vcv-time":window.vcvAjaxTime,"vcv-file-id":e}).then((function(r){if(t.serverProgressRequest&&t.serverProgressRequest.cancelled)t.serverProgressRequest=null;else{var s;try{s=JSON.parse(r)}catch(a){console.warn("Failed to parse, no valid json.",a);var n=t.getJsonFromString(r);s=JSON.parse(n)}var o=s&&s.statusMessages;o&&t.setState({statusMessages:o}),t.state.importRequestDone?t.setState({importingDone:!0}):window.setTimeout((function(){t.createServerProgressRequest(e)}),200)}}))}},{key:"createServerImportRequest",value:function(e){var t=this;this.serverImportRequest=d.appAdminServerRequest({"vcv-action":"vcv:addon:exportImport:continueImport:adminNonce","vcv-nonce":window.vcvNonce,"vcv-time":window.vcvAjaxTime,"vcv-file-id":e}).then((function(r){if(t.serverImportRequest&&t.serverImportRequest.cancelled)t.serverImportRequest=null;else{var s;try{s=JSON.parse(r)}catch(i){console.warn("Failed to parse, no valid json.",i);var n=t.getJsonFromString(r);s=JSON.parse(n)}var o={importRequestDone:!0},a=s&&s.message;a?o.errorMessage=a:t.createServerProgressRequest(e),t.setState(o)}}))}},{key:"getBackButton",value:function(){var e=window.VCV_I18N&&window.VCV_I18N(),t=e?e.backToImport:"Back to import";return s.createElement("p",{className:"description"},s.createElement("a",{href:window.vcvBackToImportLink,key:"vcvGoBackButton"},t))}},{key:"getStatusMessages",value:function(){var e=window.VCV_I18N&&window.VCV_I18N(),t=e?e.startingImportProcess:"Starting import process...",r=[];return r.push(s.createElement("p",{key:"vcvImportStatusFirstMessage",className:"description"},t)),this.state.statusMessages.forEach((function(e,t){r.push(s.createElement("p",{key:"vcvImportStatusMessage".concat(t),className:"description",dangerouslySetInnerHTML:{__html:e}}))})),this.state.errorMessage&&r.push(s.createElement("p",{key:"vcvImportErrorMessage",className:"description"},s.createElement("strong",{dangerouslySetInnerHTML:{__html:this.state.errorMessage}}))),this.state.importingDone&&r.push(this.getBackButton()),r}},{key:"render",value:function(){var e=window.VCV_I18N&&window.VCV_I18N(),t=e?e.continueImport:"Continue importing",r=s.createElement(s.Fragment,null,s.createElement("p",{className:"submit"},s.createElement("input",{type:"submit",name:"submit",id:"vcv-submit",className:"button vcv-dashboard-button vcv-dashboard-button--save vcv-dashboard-button--inline",value:t,onClick:this.handleImportClick})),this.getBackButton());return this.state.importing?this.getStatusMessages():r}}]),r}(s.Component),h=document.querySelector("#vcv-import-container");h&&n.render(s.createElement(p,null),h)}},[["./addon/exportImport/index.js"]]]);